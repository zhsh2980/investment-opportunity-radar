{% extends "base.html" %}

{% block title %}å†å²è®°å½• - æŠ•èµ„æœºä¼šé›·è¾¾{% endblock %}

{% block content %}
<div class="history-page">
    <header class="page-header">
        <h1>ğŸ“š å†å²è®°å½•</h1>
    </header>

    <!-- ç­›é€‰åŒº -->
    <section class="filter-section">
        <form method="GET" action="/history" class="filter-form">
            <div class="filter-row">
                <div class="filter-group">
                    <label>å¼€å§‹æ—¥æœŸ</label>
                    <input type="date" name="start_date" value="{{ start_date }}">
                </div>
                <div class="filter-group">
                    <label>ç»“æŸæ—¥æœŸ</label>
                    <input type="date" name="end_date" value="{{ end_date }}">
                </div>
                <div class="filter-group">
                    <label>æœ€ä½è¯„åˆ†</label>
                    <input type="number" name="min_score" value="{{ min_score }}" min="0" max="100" step="10">
                </div>
                <div class="filter-group">
                    <label>å…³é”®è¯</label>
                    <input type="text" name="keyword" value="{{ keyword }}" placeholder="æ ‡é¢˜/å…¬ä¼—å·">
                </div>
                <div class="filter-group">
                    <button type="submit" class="btn-filter">æœç´¢</button>
                </div>
            </div>
        </form>
    </section>

    <!-- ç»“æœåˆ—è¡¨ -->
    <section class="results-section">
        <div class="results-header">
            <p class="results-count">å…± {{ analyses|length }} æ¡ç»“æœ</p>
            <div class="export-buttons">
                <a href="/api/export/analyses?format=json&start_date={{ start_date }}&end_date={{ end_date }}&min_score={{ min_score }}"
                    class="btn-export" target="_blank">ğŸ“„ å¯¼å‡º JSON</a>
                <a href="/api/export/analyses?format=csv&start_date={{ start_date }}&end_date={{ end_date }}&min_score={{ min_score }}"
                    class="btn-export">ğŸ“Š å¯¼å‡º CSV</a>
            </div>
        </div>

        {% if analyses %}
        <div class="history-table-wrapper">
            <table class="history-table">
                <thead>
                    <tr>
                        <th>æ—¥æœŸ</th>
                        <th>è¯„åˆ†</th>
                        <th>æœºä¼š</th>
                        <th>æ ‡é¢˜</th>
                        <th>å…¬ä¼—å·</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for analysis in analyses %}
                    <tr>
                        <td>{{ analysis.content_item.published_at.strftime('%m-%d') }}</td>
                        <td>
                            <span
                                class="score-badge score-{{ 'high' if analysis.score >= 80 else ('medium' if analysis.score >= 60 else 'low') }}">
                                {{ analysis.score }}
                            </span>
                        </td>
                        <td>
                            {% if analysis.has_opportunity %}
                            <span class="tag-opportunity">æ˜¯</span>
                            {% else %}
                            <span class="tag-none">å¦</span>
                            {% endif %}
                        </td>
                        <td class="title-cell">
                            {{ analysis.content_item.title[:40] }}{% if analysis.content_item.title|length > 40 %}...{%
                            endif %}
                        </td>
                        <td>{{ analysis.content_item.mp_name or '-' }}</td>
                        <td>
                            <a href="/analysis/{{ analysis.id }}" class="btn-view">æŸ¥çœ‹</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å½•</p>
            <p class="hint">å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶</p>
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}