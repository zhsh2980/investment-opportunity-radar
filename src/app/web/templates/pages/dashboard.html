{% extends "base.html" %}

{% block title %}æ§åˆ¶å° - æŠ•èµ„æœºä¼šé›·è¾¾{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- ä»Šæ—¥æ¦‚è§ˆå¡ç‰‡ -->
    <section class="overview-section">
        <div class="overview-cards">
            <!-- ä»Šæ—¥ç»“è®ºå¡ -->
            <div
                class="card conclusion-card {% if opportunities_count > 0 %}has-opportunity{% else %}no-opportunity{% endif %}">
                <div class="card-icon">
                    {% if opportunities_count > 0 %}ğŸ¯{% else %}ğŸ“­{% endif %}
                </div>
                <div class="card-content">
                    <h3>ä»Šæ—¥ç»“è®º</h3>
                    {% if opportunities_count > 0 %}
                    <p class="highlight">å‘ç° <strong>{{ opportunities_count }}</strong> ä¸ªæœºä¼š</p>
                    <p class="sub">æœ€é«˜è¯„åˆ†: <strong>{{ max_score }}</strong> åˆ†</p>
                    {% else %}
                    <p class="muted">æš‚æ— æŠ•èµ„æœºä¼š</p>
                    <p class="sub">é˜ˆå€¼: {{ threshold }} åˆ†</p>
                    {% endif %}
                </div>
            </div>

            <!-- ä»»åŠ¡è¿›åº¦å¡ -->
            <div class="card progress-card">
                <div class="card-icon">ğŸ“Š</div>
                <div class="card-content">
                    <h3>ä»Šæ—¥ä»»åŠ¡</h3>
                    <div class="slots-progress">
                        {% for slot, info in slots_status.items() %}
                        <div class="slot-item {{ info.status }}">
                            <span class="slot-time">{{ slot }}</span>
                            <span class="slot-dot"></span>
                        </div>
                        {% endfor %}
                    </div>
                    <p class="sub">å·²åˆ†æ {{ total_analyzed }} ç¯‡</p>
                </div>
            </div>

            <!-- å¿«é€Ÿå…¥å£å¡ -->
            <div class="card quick-card">
                <div class="card-icon">ğŸš€</div>
                <div class="card-content">
                    <h3>å¿«é€Ÿå…¥å£</h3>
                    <div class="quick-links">
                        <a href="/daily/{{ today }}" class="quick-link">ğŸ“… ä»Šæ—¥æ—¥æŠ¥</a>
                        <a href="/history" class="quick-link">ğŸ“š å†å²è®°å½•</a>
                        <a href="/healthz" target="_blank" class="quick-link">â¤ï¸ å¥åº·æ£€æŸ¥</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ä»Šæ—¥æœºä¼šåˆ—è¡¨ -->
    {% if opportunities %}
    <section class="section">
        <h2 class="section-title">ğŸ¯ ä»Šæ—¥æœºä¼š</h2>
        <div class="opportunity-list">
            {% for analysis in opportunities %}
            <a href="/analysis/{{ analysis.id }}" class="opportunity-card">
                <div
                    class="opp-score score-{{ 'high' if analysis.score >= 80 else ('medium' if analysis.score >= 60 else 'low') }}">
                    {{ analysis.score }}
                </div>
                <div class="opp-content">
                    <h4>{{ analysis.content_item.title }}</h4>
                    <p class="opp-meta">
                        <span class="mp-name">{{ analysis.content_item.mp_name or 'æœªçŸ¥å…¬ä¼—å·' }}</span>
                        <span class="pub-time">{{ analysis.content_item.published_at.strftime('%m-%d %H:%M') }}</span>
                    </p>
                    <p class="opp-summary">{{ analysis.summary_md[:100] }}...</p>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- æœ€è¿‘åˆ†æ -->
    <section class="section">
        <h2 class="section-title">ğŸ“ æœ€è¿‘åˆ†æ</h2>
        {% if recent_analyses %}
        <div class="analysis-table-wrapper">
            <table class="analysis-table">
                <thead>
                    <tr>
                        <th>è¯„åˆ†</th>
                        <th>æ ‡é¢˜</th>
                        <th>å…¬ä¼—å·</th>
                        <th>æ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for analysis in recent_analyses %}
                    <tr
                        class="{% if analysis.has_opportunity and analysis.score >= threshold %}row-opportunity{% endif %}">
                        <td>
                            <span
                                class="score-badge score-{{ 'high' if analysis.score >= 80 else ('medium' if analysis.score >= 60 else 'low') }}">
                                {{ analysis.score }}
                            </span>
                        </td>
                        <td class="title-cell">{{ analysis.content_item.title[:40] }}{% if
                            analysis.content_item.title|length > 40 %}...{% endif %}</td>
                        <td>{{ analysis.content_item.mp_name or '-' }}</td>
                        <td>{{ analysis.content_item.published_at.strftime('%m-%d %H:%M') }}</td>
                        <td>
                            <a href="/analysis/{{ analysis.id }}" class="btn-view">æŸ¥çœ‹</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <p>æš‚æ— åˆ†æç»“æœ</p>
            <p class="hint">å½“ WeRSS æœ‰æ–°æ–‡ç« æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†æ</p>
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}