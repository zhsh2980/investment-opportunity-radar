可以的。你现在最需要的其实是一个“**AI 执行手册**”：把这 10 份文档当作**唯一事实来源**，再给 AI 一个**严格的工作流、产出物清单、验收关卡、以及每一步该读哪几份文档**。这样 AI 才不会“凭感觉写”，也能持续迭代。

下面我给你一份可直接放进同一文件夹的文档：**《AI 实现指挥手册（TODO + 工作流）》**。

------

# AI 实现指挥手册（使用 10 份文档的工作流 + TODO）

## 0. 目的

让 AI 工具在**不跑偏**的前提下，按“需求 → 设计 → 接口 → 数据库 → Prompt → UI → 部署 → 任务编排 → 测试验收”的顺序完成整个系统，并且每一步都能对照验收。

------

## 1. 10 份文档的角色分工（AI 该怎么理解它们）

把 10 份文档分成 4 层：

### A. 事实与约束层（不可违背）

- **文档1：SRS/PRD** —— 需求与规则（5 次定时、22:00 必推、阈值、只推链接、详情页登录等）
- **文档6：Prompt/JSON Schema** —— DeepSeek 必须思考模型 + 强制 JSON 输出规范
- **文档9：任务编排** —— 幂等、重试、slot 逻辑、日报生成时序
- **文档10：测试验收** —— 最终裁判（做出来必须通过这些用例）

> AI 开始编码前，必须先通读这 4 份；任何实现如果与这 4 份冲突，一律视为错误。

### B. 结构设计层（决定“怎么搭”）

- **文档2：HLD** —— 架构拆分（web/worker/beat/redis/postgres/nginx）
- **文档3：LLD** —— 模块边界、任务拆分、重试策略、关键数据结构
- **文档5：DB Schema** —— 表结构、唯一约束、索引、保留策略

### C. 产品与对外契约层（决定“对外长什么样”）

- **文档4：接口设计** —— Web 路由、内部 API、钉钉落地链接规范
- **文档7：UI/交互** —— 页面信息架构、PC/手机布局、日报结构

### D. 交付与上线层（决定“怎么跑起来”）

- **文档8：部署运维** —— docker-compose/nginx/.env/备份/runbook

------

## 2. AI 的总体执行策略（强制工作流）

> 你可以把这一段直接复制给 AI 工具当“系统指令”。

### 2.1 强制原则

1. **单一事实来源**：实现必须以这 10 份文档为准，不允许擅自改规则。
2. **先跑通主链路**：先实现最小闭环：`WeRSS 拉取 → 分析 → 落库 → 22:00 日报 → 钉钉推送链接 → Web 登录查看详情`。
3. **每完成一块就自测**：按文档10的测试用例逐条跑。
4. **遇到不明确**：只能提出“必须澄清的问题”，并给默认实现（不要停工）。

### 2.2 分阶段交付（每阶段都有验收门槛）

- 阶段 0：初始化工程骨架 + 配置系统 + 最小可运行 web（/login）
- 阶段 1：数据库落地 + migrations + Admin 用户初始化
- 阶段 2：WeRSS Client + token 自动续期 + 拉取文章入库（近3天）
- 阶段 3：DeepSeek Client + JSON schema 校验 + 单篇分析落库
- 阶段 4：任务编排（run_slot）+ 幂等 + 5 次定时（先手动触发）
- 阶段 5：推送（钉钉加签）+ 规则（前4次命中才推、22:00必推）
- 阶段 6：Web 页面（日报/详情/历史）+ 响应式布局
- 阶段 7：Prompt 管理（版本化）+ 阈值可配
- 阶段 8：部署（docker-compose + nginx）+ 备份脚本
- 阶段 9：全量回归（文档10）+ 上线检查

------

## 3. AI 的“TODO 列表”（按文件/模块拆解）

> 这部分就是你说的“to do 文档去指挥 AI 怎么用 10 个文档”。
> 你可以让 AI 一条条勾选完成并输出变更清单。

### TODO-00：工程与配置（对应文档2/3/8）

-  初始化项目结构（参考 LLD 目录建议）
-  配置加载：`.env` + `config.py`
-  日志：结构化日志（run_id/slot/article_id）
-  健康检查：`GET /healthz`

验收：能本地启动 web，打开 `/login`

------

### TODO-01：数据库与迁移（对应文档5）

-  建表：app_user/settings/prompt_version/content_item/analysis_result/opportunity/slot_run/daily_report/notification_log
-  唯一约束：external_id、(run_date,slot)、(content_item_id)、msg_uuid
-  索引：published_at/score/type 等
-  管理员初始化：RADAR_ADMIN_USERNAME/PASSWORD 自动创建或 CLI 创建

验收：能跑迁移，能创建 admin，能登录

------

### TODO-02：WeRSS 客户端（对应文档1/3/8/9）

-  实现 `POST /api/auth/token` 登录拿 token
-  实现 refresh（如用）或过期重登
-  实现 `GET /api/mps`
-  实现文章列表拉取（has_content=false）+ 近72小时过滤
-  实现文章详情拉取（/api/articles/{id}）拿 raw_html
-  HTML 清洗为 raw_text（去 script/style）

验收：能把近3天文章入库 content_item，重复跑不重复入库

------

### TODO-03：DeepSeek 客户端（对应文档6）

-  固定 model=deepseek-reasoner
-  response_format=json_object
-  生成 messages：system=prompt_version、user=文章输入模板
-  解析 JSON + schema 校验
-  失败重试（最多3次）
-  写 analysis_result + 抽取 opportunity 行

验收：对 3 类文章都能得到可解析 JSON；低分不生成推送候选

------

### TODO-04：Slot 编排与幂等（对应文档9/5）

-  `get_or_create_slot_run(run_date, slot)`（幂等）
-  `ingest_window(run_id, window_start, window_end)`
-  `enqueue_analyses(run_id)`（只对 analyzed_status=0）
-  `finalize_and_notify(run_id)`（前4次命中才推）
-  22:00：`generate_daily_report(date)` + 必推

验收：重复触发同一 slot 不会重复分析、不会重复推送

------

### TODO-05：钉钉推送（对应文档1/3/9）

-  加签算法（timestamp + sign）
-  markdown 模板：只含摘要 + 链接
-  msg_uuid 幂等
-  前4次：无机会不推
-  22:00：必推日报（无机会文案固定）

验收：钉钉能收到消息；重复执行不重复收到

------

### TODO-06：Web 页面（对应文档7/4）

-  Dashboard：今日概览 + slot 进度
-  日报页：digest_md + 全量列表 + failures（如有）
-  详情页：PC 左右分栏；移动端上下布局；结论+原文
-  历史页：日期/评分/类型/关键词筛选
-  登录 + remember_me

验收：从钉钉点开链接能登录后直达页面；手机体验符合要求

------

### TODO-07：Prompt 管理与阈值（对应文档6/7/4）

-  prompts 列表/查看/新增版本/激活
-  settings：push_score_threshold 可改（立即生效）
-  每次分析绑定 prompt_version_id（可追溯）

验收：改 prompt 后新分析使用新版本；阈值改为 80 后推送逻辑立刻变化

------

### TODO-08：部署与备份（对应文档8）

-  docker-compose 全套跑起来
-  nginx 反代公网 IP
-  pg_dump 备份 cron
-  runbook：401、DeepSeek 超时、钉钉失败排查路径

验收：重启服务器后服务自动恢复；22:00 必推仍正常

------

### TODO-09：验收回归（对应文档10）

-  跑通 TC-PUSH-01/02/04（核心）
-  跑通 TC-IDEMP-01/02/03（核心）
-  跑通 TC-UI-02/03/04（核心）
-  输出一份“验收报告”（哪些用例通过/失败原因/修复建议）

------

## 4. 给 AI 的“输入方式建议”（你怎么喂文档最有效）

### 4.1 推荐做法：一次性给“目录 + 逐阶段喂”

如果 AI 工具上下文有限，不要一次塞 10 份全文。按阶段给：

- 阶段 0-1：文档1、2、3、5、8（先搭架构/DB/部署骨架）
- 阶段 2：文档1、3、9（WeRSS 拉取、幂等）
- 阶段 3：文档6、3（DeepSeek 分析）
- 阶段 4-5：文档9、4、1（编排 + 推送）
- 阶段 6-7：文档7、4、6（UI + Prompt 管理）
- 阶段 8-9：文档8、10（上线与验收）

### 4.2 必须让 AI 执行的“对照声明”

每次开始一个阶段，让 AI 先输出一句：

- “我本阶段依据：文档X、Y、Z；不新增需求；若冲突以文档1/6/9/10为准。”

这样能强行约束它不乱改规则。

------

## 5. 让 AI 输出什么（统一交付格式）

每完成一个 TODO 阶段，要求 AI 输出：

1. **本阶段完成项**（勾选哪些 TODO）
2. **变更清单**（新增/修改了哪些文件）
3. **如何运行**（命令 + 环境变量）
4. **自测结果**（对照文档10跑了哪些 case）
5. **遗留问题**（必须明确：影响、原因、下一步）

------

## 6. 最推荐的“给 AI 的启动指令”（你可直接复制）

你把下面这段发给 AI 工具即可（把文件名按你的实际命名替换）：

> 你要实现一个系统，所有需求与设计已写在同文件夹下的 10 份文档中：
> 1_SRS.md, 2_HLD.md, 3_LLD.md, 4_API.md, 5_DB.md, 6_PROMPT.md, 7_UI.md, 8_DEPLOY.md, 9_FLOW.md, 10_TEST.md
> 规则：以文档1/6/9/10为最高优先级，不允许新增需求。
> 请按《AI 实现指挥手册》的 TODO 阶段推进。
> 先完成 TODO-00~TODO-02，并输出：完成项、变更文件清单、运行命令、自测结果、遗留问题。

------

如果你愿意，我还能再给你两个“更狠更好用”的版本：

1. **超短版**（100 行以内，适合贴进 Cursor/Claude Code 的 system prompt）
2. **逐文件实现清单版**（把每个文件需要有哪些类/函数/接口都列出来，AI 基本照写就能跑）