# 文档 7/10：UI / 交互设计说明（Web 界面）

> 目标：把“钉钉只推链接 → 点击打开 Web → 快速看结论 + 原文 + 当日日报”的体验设计清楚，且满足：
>
> - **机会详情页必须登录**（Cookie Session + 记住我）
> - PC **左右分栏**；手机 **上下布局**
> - 22:00 日报页必须能“像浓缩资讯一样快速过一遍”
> - 支持历史追溯与筛选（评分阈值、类型、日期等）

------

## 1. 信息架构（IA）

### 1.1 顶层导航（登录后可见）

- **首页**（Dashboard）：今日概览 + 快捷入口
- **今日**（Today / 日报）：默认打开今天日报页
- **历史**（History）：按日期/评分/类型检索
- **Prompts**（提示词）：编辑/版本管理（管理员）
- **设置**（Settings）：阈值、remember_me 天数等（管理员）
- **退出登录**

> MVP 可用顶部导航栏（PC）+ 汉堡菜单（移动端）。

------

## 2. 全局交互规范

### 2.1 登录态与“记住我”

- 用户从钉钉点开链接：
  - 未登录：跳转到 `/login?next=<原链接>`
  - 登录成功：自动回跳到原链接（机会详情页或日报页）
- “记住我”：
  - 默认勾选（建议）——更符合你“不想每次输账号密码”
  - Cookie 有效期默认 30 天（可在设置页修改）

### 2.2 链接落地策略（钉钉消息点击后的目标）

- **前 4 次（07/12/14/18）命中机会**：落地到**机会详情页**
  - `/analysis/{analysis_id}`
- **22:00 日报必推**：落地到**当日日报页**
  - `/daily/{YYYY-MM-DD}`
- 若当日没有机会：日报页顶部必须显示“今日无投资机会”，但仍要展示浓缩资讯与全量分析清单。

### 2.3 展示优先级（避免信息过载）

- 第一屏只让你看到：
  1. 是否有机会（高亮）
  2. 若有：最高分机会 + 最小行动方案
  3. 若无：当天最重要的“关注点/风险提示/未来时间点”
- 原文始终存在，但默认不抢第一屏（避免手机上无限长）。

------

## 3. 页面设计（Page Specs）

## 3.1 登录页 `/login`

### 3.1.1 页面元素

- 标题：机会雷达登录
- 表单：
  - username
  - password
  - checkbox：记住我（默认勾选）
  - 登录按钮
- 错误提示：用户名或密码错误
- 安全提示（小字）：公网访问请勿泄露账号

### 3.1.2 交互逻辑

- 登录成功：
  - 若有 next：跳转 next
  - 否则跳转 `/`

------

## 3.2 首页 Dashboard `/`

### 3.2.1 目标

用一屏把“今天是不是有事要做”说清楚。

### 3.2.2 信息布局（PC）

**上方 3 个卡片**

1. 今日结论卡

- 有机会：显示“机会数 + 最高分 + 主要类型”
- 无机会：显示“今日无投资机会（截至目前）”

1. 今日任务进度卡（5 个 slot）

- 07/12/14/18/22：状态（未跑/成功/失败）
- 今日总分析篇数

1. 快速入口卡

- 打开今日日报
- 打开历史
- 打开 Prompts（管理员）

**下方**

- 今日机会列表（若有）
  - 列：score、类型、标题、公众号、发布时间、查看详情按钮
- 今日最新分析（不论是否机会）
  - 列表 10 条以内

### 3.2.3 移动端布局

- 纵向卡片堆叠
- “今日结论卡”置顶
- 任务进度用横向滚动 chip 展示（07/12/14/18/22）

------

## 3.3 机会详情页 `/analysis/{analysis_id}`（钉钉机会提醒落地点）

### 3.3.1 目标

让你在 30 秒内判断：**做不做、怎么做、什么时候做、风险是什么**；然后随手滑过去看原文证据。

### 3.3.2 PC 布局（左右分栏）

- **左栏（分析结论）**（固定宽度，例如 40%）
  - 顶部信息条：
    - score（大数字 + 颜色等级）
    - 类型标签（可转债打新/基金套利等）
    - 发布时间 + 公众号名
  - 一句话结论（summary）
  - 【行动步骤】action_steps（编号列表，强调最小行动方案）
  - 【关键时间窗】time_window（若不确定显示“需核验”）
  - 【关键参数】codes/基金代码/溢价率等（若原文提到）
  - 【风险提示】risk_warnings（红色提示）
  - 【核验清单】verification_checklist（checkbox 风格）
  - 【建议搜索】search_suggestions（可一键复制按钮）
  - 【证据摘录】evidence（1-3 条短句）
- **右栏（原文）**（60%）
  - 原文标题 + 原文链接（新窗口打开）
  - 原文 HTML 渲染区（sanitize 后）
  - 可选：目录/小标题锚点（后期优化）

### 3.3.3 移动端布局（上下展示）

- 上半部分：分析结论卡（同 PC 左栏内容，但折叠一些）
  - 默认展开：summary、行动步骤、关键时间窗、风险提示
  - 可折叠区域：核验清单、建议搜索、证据摘录
- 下半部分：原文（默认折叠到 2 屏高度，提供“展开原文”按钮）

### 3.3.4 关键交互

- “复制搜索关键词”按钮：把 search_suggestions 合并复制
- “复制行动步骤”按钮：方便你发给自己/朋友
- “切换原文/结论”tab（移动端可选）
- “上一条/下一条”（历史浏览体验提升，后期可加）

------

## 3.4 当日日报页 `/daily/{YYYY-MM-DD}`（22:00 必推落地点）

### 3.4.1 目标

把当天 5 次分析产出压成“一篇资讯”，让你 1-2 分钟过完。

### 3.4.2 页面结构（强制）

1. **日报头部**

- 日期（北京时间）
- 今日结论：
  - 有机会：显示机会数、最高分、最重要 1 条机会（卡片）
  - 无机会：醒目展示 **“今日无投资机会”**
- 任务进度：07/12/14/18/22 的执行状态

1. **浓缩资讯 digest（核心）**

- digest_md 渲染区（markdown）
- 结构建议（让模型输出时遵循）：
  - 今日重点（3-6 条 bullet）
  - 机会/可行动事项（若有，列 top 3）
  - 风险/提醒（2-4 条）
  - 明日/未来关注（关键日期、申购日等）

1. **当日全量分析列表**

- 表格/列表形式：
  - score、是否机会、类型、标题、公众号、发布时间、查看详情
- 支持筛选：
  - 仅看机会（toggle）
  - min_score 滑块（默认 0，可拖到 60）
  - 类型筛选（多选）

1. **失败/异常列表（若存在）**

- 哪些文章分析失败、失败原因（简略）
- 提供“稍后重试”按钮（管理员可见，后期实现）

### 3.4.3 移动端优化

- 把“今日结论”与“浓缩资讯”放在第一屏
- 全量列表默认折叠为“机会优先 + 最近 10 条”，其余点“展开全部”

------

## 3.5 历史页 `/history`

### 3.5.1 目标

快速回溯历史机会与原文，支持“我记得某天有个转债”的检索。

### 3.5.2 功能

- 筛选区：
  - 日期范围（默认最近 7 天）
  - min_score（默认 60）
  - 类型（可转债打新/上市/基金套利/其他）
  - 关键词（标题/公众号）
- 结果列表：
  - 每行：日期、score、类型、标题、公众号、查看详情
- 支持导出（后期）：CSV/JSON（管理员）

------

## 3.6 Prompt 管理页 `/prompts`（管理员）

### 3.6.1 页面元素

- 当前生效 prompt（只读展示 + 编辑按钮）
- 编辑区（textarea）
- response_schema（只读 JSON）
- 版本历史列表（version、创建时间、是否 active、切换 active）
- 阈值 threshold（默认 60，可改）

### 3.6.2 交互逻辑

- 保存：
  - 新建一条版本（version+1）
  - 可选立即激活（默认激活）
- 回滚：
  - 选中旧版本 → 激活 → 立刻生效（后续分析用新版本）

------

## 3.7 设置页 `/settings`（管理员）

- 推送阈值 `push_score_threshold`（默认 60）
- remember_me 天数（默认 30）
- schedule_slots（只读或可编辑，MVP 可只读）
- window_days（默认 3）

------

## 4. 组件级设计（可复用 UI 组件）

### 4.1 机会卡（Opportunity Card）

- score 徽章（颜色分级）
- 类型标签
- 标题 + 公众号 + 时间
- “最小行动方案”前 2 步（精简）
- 查看详情按钮

### 4.2 风险提示组件

- 红色边框
- 列表展示 risk_warnings

### 4.3 核验清单组件

- checkbox 列表（verification_checklist）
- “全选复制为待办”按钮（可选）

### 4.4 原文展示组件（HTML Render）

- sanitize（去 script/iframe/on* 事件等）
- 图片懒加载（后期）
- 长文折叠（移动端默认）

------

## 5. 响应式布局规范（PC vs Mobile）

### 5.1 断点建议

- `>= 1024px`：PC 双栏
- `< 1024px`：移动端单栏堆叠

### 5.2 详情页具体规则

- PC：
  - 左栏 sticky（滚动时结论不丢）
  - 右栏可独立滚动（可选）
- Mobile：
  - 结论卡默认展开核心块
  - 原文默认折叠，避免“打开即刷屏”

------

## 6. 可用性与无障碍（简要）

- 所有关键按钮有明确文字（不只图标）
- 颜色分级同时显示文字（避免色盲）
- 长列表支持分页/无限滚动（后期）

------

## 7. 与推送消息的联动（体验闭环）

### 7.1 机会推送（前 4 次命中阈值）

钉钉里看到：

- “【机会提醒】14:00 发现 1 条（最高分 78）”
- 链接点开 → 登录一次后 → 直接到该机会详情页

### 7.2 22:00 日报推送（必发）

钉钉里看到：

- “【日报】2026-01-08：今日无投资机会”
- 链接点开 → 今日日报页第一屏就看到结论 + 浓缩资讯

------

## 8. 后续可选增强（不影响 MVP）

- 详情页“执行标记”：我已执行/不执行/待观察（形成回测数据）
- 原文关键句高亮定位（根据 evidence 的 location_hint 做锚点）
- 分享：生成一次性只读分享链接（但你目前要求“必须登录”，后期再议）

------

如果你认可这份 UI/交互文档，我下一份会输出 **文档 8/10：部署与运维文档（Docker Compose + Nginx + 环境变量 + 日志 + 备份 + 升级）**，并把 WeRSS token 自动续期（3 天过期）与 5 次定时触发的运行方式写成可直接照抄的部署步骤。